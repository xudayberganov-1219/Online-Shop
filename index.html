<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Commerce Storefront</title>
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
        }

        /* Accessibility & Focus Styles */
        a:focus, button:focus, input:focus {
            outline: 3px solid #007bff;
            outline-offset: 2px;
        }

        /* Header Styles */
        header {
            background-color: #fff;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            color: #007bff;
            text-decoration: none;
        }

        .search-cart-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .search-bar {
            display: flex;
            align-items: center;
        }

        .search-bar input {
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            min-width: 200px;
        }

        .cart-preview {
            position: relative;
            cursor: pointer;
            background: #007bff;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            text-decoration: none;
        }

        .cart-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ff4757;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
        }

        /* Main Content */
        main {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        /* Filters */
        .filters {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 2rem;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .filter-select {
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            min-width: 150px;
        }

        /* Product Grid */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 2rem;
        }

        .product-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }

        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background-color: #f0f0f0;
        }

        .product-info {
            padding: 1.5rem;
        }

        .product-category {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 0.5rem;
        }

        .product-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            min-height: 2.5rem;
        }

        .product-description {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 1rem;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .product-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: #007bff;
            margin-bottom: 1rem;
        }

        .product-stock {
            font-size: 0.9rem;
            color: #28a745;
            margin-bottom: 1rem;
        }

        .out-of-stock {
            color: #dc3545;
        }

        .add-to-cart {
            width: 100%;
            padding: 0.75rem;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s ease;
        }

        .add-to-cart:hover {
            background: #0056b3;
        }

        .add-to-cart:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            margin: 2rem 0;
            gap: 0.5rem;
        }

        .pagination button {
            padding: 0.5rem 1rem;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
            border-radius: 4px;
        }

        .pagination button.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }

        .pagination button:hover:not(.active) {
            background: #f8f9fa;
        }

        /* Cart Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            border-radius: 8px;
            padding: 2rem;
            position: relative;
        }

        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            cursor: pointer;
            background: none;
            border: none;
        }

        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #eee;
        }

        .cart-items {
            margin-bottom: 2rem;
        }

        .cart-item {
            display: flex;
            padding: 1rem 0;
            border-bottom: 1px solid #eee;
        }

        .cart-item-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            margin-right: 1rem;
            border-radius: 4px;
        }

        .cart-item-details {
            flex: 1;
        }

        .cart-item-name {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .cart-item-price {
            color: #007bff;
            font-weight: 600;
        }

        .cart-item-quantity {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .quantity-btn {
            width: 30px;
            height: 30px;
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        .quantity-input {
            width: 50px;
            text-align: center;
            padding: 0.25rem;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .remove-item {
            color: #dc3545;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            margin-left: 1rem;
        }

        .cart-totals {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .grand-total {
            font-size: 1.2rem;
            font-weight: 700;
            color: #007bff;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 2px solid #eee;
        }

        .checkout-btn {
            width: 100%;
            padding: 1rem;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .checkout-btn:hover {
            background: #218838;
        }

        /* Checkout Form */
        .checkout-form {
            display: none;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .form-group input, .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-row {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .form-row .form-group {
            flex: 1;
            min-width: 200px;
        }

        .submit-order {
            width: 100%;
            padding: 1rem;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 1rem;
        }

        .submit-order:hover {
            background: #0056b3;
        }

        /* Receipt */
        .receipt {
            display: none;
        }

        .receipt-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .receipt-title {
            font-size: 2rem;
            color: #28a745;
            margin-bottom: 0.5rem;
        }

        .order-id {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 2rem;
        }

        .receipt-details {
            background: #f8f9fa;
            padding: 2rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }

        .receipt-section {
            margin-bottom: 1.5rem;
        }

        .receipt-section h3 {
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #eee;
        }

        .receipt-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
        }

        .continue-shopping {
            width: 100%;
            padding: 1rem;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 1rem;
        }

        .continue-shopping:hover {
            background: #5a6268;
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: #666;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .empty-state p {
            margin-bottom: 2rem;
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 4rem 2rem;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .search-bar input {
                min-width: 100%;
            }

            .filters {
                flex-direction: column;
                align-items: stretch;
            }

            .form-row {
                flex-direction: column;
            }
        }

        @media (max-width: 480px) {
            .product-grid {
                grid-template-columns: 1fr;
            }

            .cart-item {
                flex-direction: column;
            }

            .cart-item-image {
                margin-bottom: 1rem;
            }
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 1rem 2rem;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1001;
            transform: translateX(150%);
            transition: transform 0.3s ease;
        }

        .toast.error {
            background: #dc3545;
        }

        .toast.show {
            transform: translateX(0);
        }

        /* Footer */
        footer {
            background: #333;
            color: white;
            text-align: center;
            padding: 2rem;
            margin-top: 3rem;
        }

        footer a {
            color: #007bff;
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-container">
            <a href="#" class="logo">ShopEasy</a>
            <div class="search-cart-container">
                <div class="search-bar">
                    <input type="text" id="searchInput" placeholder="Search products...">
                </div>
                <a href="#" class="cart-preview" id="cartPreview">
                    ðŸ›’ Cart <span class="cart-count" id="cartCount">0</span>
                </a>
            </div>
        </div>
    </header>

    <main>
        <div class="filters">
            <select id="categoryFilter" class="filter-select">
                <option value="">All Categories</option>
            </select>
            <select id="sortFilter" class="filter-select">
                <option value="name-asc">Name A-Z</option>
                <option value="name-desc">Name Z-A</option>
                <option value="price-low">Price: Low to High</option>
                <option value="price-high">Price: High to Low</option>
            </select>
        </div>

        <div id="loading" class="loading">
            Loading products...
        </div>

        <div id="productGrid" class="product-grid">
            <!-- Products will be dynamically inserted here -->
        </div>

        <div class="pagination" id="pagination">
            <!-- Pagination buttons will be dynamically inserted here -->
        </div>
    </main>

    <!-- Cart Modal -->
    <div class="modal" id="cartModal">
        <div class="modal-content">
            <button class="close-modal" id="closeCartModal">&times;</button>
            
            <div id="cartView">
                <div class="cart-header">
                    <h2>Your Shopping Cart</h2>
                    <span id="cartItemCount">0 items</span>
                </div>
                
                <div class="cart-items" id="cartItems">
                    <!-- Cart items will be dynamically inserted here -->
                </div>
                
                <div class="cart-totals">
                    <div class="total-row">
                        <span>Subtotal:</span>
                        <span id="subtotal">$0.00</span>
                    </div>
                    <div class="total-row">
                        <span>Tax (8.5%):</span>
                        <span id="tax">$0.00</span>
                    </div>
                    <div class="total-row grand-total">
                        <span>Total:</span>
                        <span id="grandTotal">$0.00</span>
                    </div>
                </div>
                
                <button class="checkout-btn" id="checkoutBtn">Proceed to Checkout</button>
            </div>
            
            <div id="checkoutForm" class="checkout-form">
                <h2>Checkout</h2>
                <form id="orderForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="customerName">Full Name *</label>
                            <input type="text" id="customerName" required>
                        </div>
                        <div class="form-group">
                            <label for="customerEmail">Email Address *</label>
                            <input type="email" id="customerEmail" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="shippingAddress">Shipping Address *</label>
                        <textarea id="shippingAddress" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="paymentInfo">Payment Information (Mock) *</label>
                        <input type="text" id="paymentInfo" placeholder="Enter card number (mock)" required>
                    </div>
                    
                    <button type="submit" class="submit-order">Place Order</button>
                </form>
            </div>
            
            <div id="receipt" class="receipt">
                <div class="receipt-header">
                    <h2 class="receipt-title">Order Confirmed!</h2>
                    <p class="order-id" id="orderIdDisplay">Order ID: #<span id="orderId"></span></p>
                    <p>Thank you for your purchase!</p>
                </div>
                
                <div class="receipt-details">
                    <div class="receipt-section">
                        <h3>Customer Information</h3>
                        <p id="customerInfo"></p>
                    </div>
                    
                    <div class="receipt-section">
                        <h3>Order Items</h3>
                        <div id="receiptItems">
                            <!-- Receipt items will be dynamically inserted here -->
                        </div>
                    </div>
                    
                    <div class="receipt-section">
                        <h3>Order Summary</h3>
                        <div class="receipt-item">
                            <span>Subtotal:</span>
                            <span id="receiptSubtotal">$0.00</span>
                        </div>
                        <div class="receipt-item">
                            <span>Tax (8.5%):</span>
                            <span id="receiptTax">$0.00</span>
                        </div>
                        <div class="receipt-item" style="font-weight: bold; font-size: 1.1rem;">
                            <span>Total:</span>
                            <span id="receiptTotal">$0.00</span>
                        </div>
                    </div>
                    
                    <div class="receipt-section">
                        <h3>Order Details</h3>
                        <div class="receipt-item">
                            <span>Order Date:</span>
                            <span id="orderDate"></span>
                        </div>
                        <div class="receipt-item">
                            <span>Order ID:</span>
                            <span id="receiptOrderId"></span>
                        </div>
                    </div>
                </div>
                
                <button class="continue-shopping" id="continueShopping">Continue Shopping</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">Notification</div>

    <footer>
        <p>&copy; 2023 ShopEasy. All rights reserved. | <a href="admin.html">Admin Login</a></p>
    </footer>

    <script>
        /**
         * E-COMMERCE STOREFRONT - DATA MANAGEMENT
         * Handles all data operations using localStorage
         */
        class StoreDataManager {
            constructor() {
                this.initData();
            }

            // Initialize data in localStorage if it doesn't exist
            initData() {
                // Check if products exist, if not, seed them
                if (!localStorage.getItem('products')) {
                    this.seedProducts();
                }

                // Initialize cart if it doesn't exist
                if (!localStorage.getItem('cart')) {
                    localStorage.setItem('cart', JSON.stringify([]));
                }

                // Initialize orders if it doesn't exist
                if (!localStorage.getItem('orders')) {
                    localStorage.setItem('orders', JSON.stringify([]));
                }
            }

            // Generate 100+ products with realistic data
            seedProducts() {
                const categories = [
                    'Electronics', 'Clothing', 'Home & Kitchen', 'Books', 
                    'Sports', 'Beauty', 'Toys', 'Automotive', 'Health', 'Grocery'
                ];
                
                const productNames = [
                    'Wireless Headphones', 'Smart Watch', 'Laptop', 'Tablet', 'Smartphone',
                    'Coffee Maker', 'Blender', 'Toaster', 'Microwave', 'Refrigerator',
                    'T-Shirt', 'Jeans', 'Sneakers', 'Jacket', 'Dress',
                    'Novel', 'Textbook', 'Cookbook', 'Biography', 'Mystery',
                    'Yoga Mat', 'Dumbbell', 'Tennis Racket', 'Basketball', 'Running Shoes',
                    'Shampoo', 'Conditioner', 'Face Cream', 'Perfume', 'Lipstick',
                    'Action Figure', 'Board Game', 'Puzzle', 'Doll', 'Building Blocks',
                    'Car Battery', 'Tire', 'Oil Filter', 'Car Cover', 'Jump Starter',
                    'Vitamins', 'Protein Powder', 'First Aid Kit', 'Thermometer', 'Blood Pressure Monitor',
                    'Cereal', 'Pasta', 'Rice', 'Coffee', 'Tea'
                ];

                const descriptions = [
                    'High-quality product with excellent performance and durability.',
                    'Perfect for everyday use with modern design and functionality.',
                    'Premium materials ensure long-lasting quality and satisfaction.',
                    'Innovative features designed to make your life easier.',
                    'Eco-friendly and sustainable choice for conscious consumers.',
                    'Compact design saves space while delivering maximum performance.',
                    'Easy to use with intuitive controls and clear instructions.',
                    'Backed by a 1-year warranty and excellent customer support.',
                    'Best-selling item with thousands of satisfied customers.',
                    'Limited edition product with unique features and design.'
                ];

                const products = [];
                for (let i = 1; i <= 120; i++) {
                    const categoryIndex = Math.floor(Math.random() * categories.length);
                    const nameIndex = Math.floor(Math.random() * productNames.length);
                    const descIndex = Math.floor(Math.random() * descriptions.length);
                    
                    products.push({
                        id: i,
                        name: `${productNames[nameIndex]} ${i}`,
                        price: parseFloat((Math.random() * 200 + 10).toFixed(2)),
                        category: categories[categoryIndex],
                        stock: Math.floor(Math.random() * 50) + 1,
                        description: descriptions[descIndex],
                        image: `https://picsum.photos/seed/product${i}/300/200`
                    });
                }
                
                localStorage.setItem('products', JSON.stringify(products));
                console.log('Seeded 120 products');
            }

            // Get all products
            getProducts() {
                return JSON.parse(localStorage.getItem('products') || '[]');
            }

            // Get product by ID
            getProductById(id) {
                const products = this.getProducts();
                return products.find(p => p.id === parseInt(id));
            }

            // Get cart
            getCart() {
                return JSON.parse(localStorage.getItem('cart') || '[]');
            }

            // Save cart
            saveCart(cart) {
                localStorage.setItem('cart', JSON.stringify(cart));
            }

            // Get orders
            getOrders() {
                return JSON.parse(localStorage.getItem('orders') || '[]');
            }

            // Save order
            saveOrder(order) {
                const orders = this.getOrders();
                orders.push(order);
                localStorage.setItem('orders', JSON.stringify(orders));
            }

            // Update product stock
            updateProductStock(productId, newStock) {
                const products = this.getProducts();
                const productIndex = products.findIndex(p => p.id === productId);
                if (productIndex !== -1) {
                    products[productIndex].stock = newStock;
                    localStorage.setItem('products', JSON.stringify(products));
                }
            }
        }

        /**
         * E-COMMERCE STOREFRONT - UI RENDERING
         * Handles all UI rendering and updates
         */
        class StoreUI {
            constructor(dataManager) {
                this.dataManager = dataManager;
                this.products = [];
                this.filteredProducts = [];
                this.cart = [];
                this.currentPage = 1;
                this.productsPerPage = 12;
                this.searchTerm = '';
                this.selectedCategory = '';
                this.sortOrder = 'name-asc';
                
                this.init();
            }

            // Initialize the UI
            init() {
                this.loadProducts();
                this.loadCart();
                this.renderCategories();
                this.bindEvents();
                this.updateCartPreview();
            }

            // Load products from data manager
            loadProducts() {
                this.products = this.dataManager.getProducts();
                this.applyFilters();
                this.renderProducts();
                this.renderPagination();
                document.getElementById('loading').style.display = 'none';
            }

            // Load cart from data manager
            loadCart() {
                this.cart = this.dataManager.getCart();
                this.updateCartPreview();
            }

            // Render category filter options
            renderCategories() {
                const categories = [...new Set(this.products.map(p => p.category))];
                const categoryFilter = document.getElementById('categoryFilter');
                
                // Clear existing options except the first one
                categoryFilter.innerHTML = '<option value="">All Categories</option>';
                
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    categoryFilter.appendChild(option);
                });
            }

            // Apply filters and sorting
            applyFilters() {
                this.filteredProducts = this.products.filter(product => {
                    const matchesSearch = product.name.toLowerCase().includes(this.searchTerm.toLowerCase()) ||
                                        product.description.toLowerCase().includes(this.searchTerm.toLowerCase());
                    const matchesCategory = this.selectedCategory === '' || product.category === this.selectedCategory;
                    return matchesSearch && matchesCategory;
                });

                // Apply sorting
                this.filteredProducts.sort((a, b) => {
                    switch (this.sortOrder) {
                        case 'name-asc':
                            return a.name.localeCompare(b.name);
                        case 'name-desc':
                            return b.name.localeCompare(a.name);
                        case 'price-low':
                            return a.price - b.price;
                        case 'price-high':
                            return b.price - a.price;
                        default:
                            return 0;
                    }
                });
            }

            // Render products based on current page
            renderProducts() {
                const productGrid = document.getElementById('productGrid');
                productGrid.innerHTML = '';

                const startIndex = (this.currentPage - 1) * this.productsPerPage;
                const endIndex = startIndex + this.productsPerPage;
                const pageProducts = this.filteredProducts.slice(startIndex, endIndex);

                if (pageProducts.length === 0) {
                    productGrid.innerHTML = `
                        <div class="empty-state">
                            <h3>No Products Found</h3>
                            <p>Try adjusting your search or filter criteria.</p>
                        </div>
                    `;
                    return;
                }

                pageProducts.forEach(product => {
                    const productCard = document.createElement('div');
                    productCard.className = 'product-card';
                    productCard.innerHTML = `
                        <img src="${product.image}" alt="${product.name}" class="product-image">
                        <div class="product-info">
                            <div class="product-category">${product.category}</div>
                            <h3 class="product-name">${product.name}</h3>
                            <p class="product-description">${product.description}</p>
                            <div class="product-price">$${product.price.toFixed(2)}</div>
                            <div class="product-stock ${product.stock === 0 ? 'out-of-stock' : ''}">
                                ${product.stock > 0 ? `${product.stock} in stock` : 'Out of Stock'}
                            </div>
                            <button class="add-to-cart" data-id="${product.id}" ${product.stock === 0 ? 'disabled' : ''}>
                                ${product.stock === 0 ? 'Out of Stock' : 'Add to Cart'}
                            </button>
                        </div>
                    `;
                    productGrid.appendChild(productCard);
                });
            }

            // Render pagination
            renderPagination() {
                const pagination = document.getElementById('pagination');
                pagination.innerHTML = '';

                const totalPages = Math.ceil(this.filteredProducts.length / this.productsPerPage);
                
                if (totalPages <= 1) {
                    pagination.style.display = 'none';
                    return;
                }
                pagination.style.display = 'flex';

                // Previous button
                if (this.currentPage > 1) {
                    const prevButton = document.createElement('button');
                    prevButton.textContent = 'Previous';
                    prevButton.addEventListener('click', () => {
                        this.currentPage--;
                        this.renderProducts();
                        this.renderPagination();
                        window.scrollTo(0, 0);
                    });
                    pagination.appendChild(prevButton);
                }

                // Page numbers
                for (let i = 1; i <= totalPages; i++) {
                    if (i === this.currentPage) {
                        const pageButton = document.createElement('button');
                        pageButton.textContent = i;
                        pageButton.className = 'active';
                        pagination.appendChild(pageButton);
                    } else {
                        const pageButton = document.createElement('button');
                        pageButton.textContent = i;
                        pageButton.addEventListener('click', () => {
                            this.currentPage = i;
                            this.renderProducts();
                            this.renderPagination();
                            window.scrollTo(0, 0);
                        });
                        pagination.appendChild(pageButton);
                    }
                }

                // Next button
                if (this.currentPage < totalPages) {
                    const nextButton = document.createElement('button');
                    nextButton.textContent = 'Next';
                    nextButton.addEventListener('click', () => {
                        this.currentPage++;
                        this.renderProducts();
                        this.renderPagination();
                        window.scrollTo(0, 0);
                    });
                    pagination.appendChild(nextButton);
                }
            }

            // Update cart preview in header
            updateCartPreview() {
                const cartCount = document.getElementById('cartCount');
                const itemCount = this.cart.reduce((total, item) => total + item.quantity, 0);
                cartCount.textContent = itemCount;
                
                const cartItemCount = document.getElementById('cartItemCount');
                if (cartItemCount) {
                    cartItemCount.textContent = `${itemCount} item${itemCount !== 1 ? 's' : ''}`;
                }
            }

            // Render cart items in modal
            renderCart() {
                const cartItems = document.getElementById('cartItems');
                cartItems.innerHTML = '';

                if (this.cart.length === 0) {
                    cartItems.innerHTML = `
                        <div class="empty-state">
                            <h3>Your Cart is Empty</h3>
                            <p>Add some products to get started!</p>
                        </div>
                    `;
                    this.updateCartTotals();
                    return;
                }

                this.cart.forEach(item => {
                    const product = this.dataManager.getProductById(item.productId);
                    if (!product) return;

                    const cartItem = document.createElement('div');
                    cartItem.className = 'cart-item';
                    cartItem.innerHTML = `
                        <img src="${product.image}" alt="${product.name}" class="cart-item-image">
                        <div class="cart-item-details">
                            <h4 class="cart-item-name">${product.name}</h4>
                            <div class="cart-item-price">$${product.price.toFixed(2)}</div>
                            <div class="cart-item-quantity">
                                <button class="quantity-btn decrease-qty" data-id="${item.productId}">-</button>
                                <input type="number" class="quantity-input" value="${item.quantity}" min="1" max="${product.stock + item.quantity}" data-id="${item.productId}">
                                <button class="quantity-btn increase-qty" data-id="${item.productId}">+</button>
                                <button class="remove-item" data-id="${item.productId}">Remove</button>
                            </div>
                        </div>
                    `;
                    cartItems.appendChild(cartItem);
                });

                this.updateCartTotals();
            }

            // Update cart totals
            updateCartTotals() {
                const subtotal = this.cart.reduce((total, item) => {
                    const product = this.dataManager.getProductById(item.productId);
                    return total + (product ? product.price * item.quantity : 0);
                }, 0);

                const tax = subtotal * 0.085; // 8.5% tax
                const grandTotal = subtotal + tax;

                document.getElementById('subtotal').textContent = `$${subtotal.toFixed(2)}`;
                document.getElementById('tax').textContent = `$${tax.toFixed(2)}`;
                document.getElementById('grandTotal').textContent = `$${grandTotal.toFixed(2)}`;
            }

            // Render receipt after successful checkout
            renderReceipt(order) {
                // Customer info
                document.getElementById('customerInfo').textContent = 
                    `${order.customerName} | ${order.customerEmail} | ${order.shippingAddress}`;

                // Order items
                const receiptItems = document.getElementById('receiptItems');
                receiptItems.innerHTML = '';
                
                order.items.forEach(item => {
                    const receiptItem = document.createElement('div');
                    receiptItem.className = 'receipt-item';
                    receiptItem.innerHTML = `
                        <span>${item.name} (x${item.quantity})</span>
                        <span>$${(item.price * item.quantity).toFixed(2)}</span>
                    `;
                    receiptItems.appendChild(receiptItem);
                });

                // Order summary
                document.getElementById('receiptSubtotal').textContent = `$${order.subtotal.toFixed(2)}`;
                document.getElementById('receiptTax').textContent = `$${order.tax.toFixed(2)}`;
                document.getElementById('receiptTotal').textContent = `$${order.total.toFixed(2)}`;

                // Order details
                document.getElementById('orderDate').textContent = order.timestamp;
                document.getElementById('receiptOrderId').textContent = order.id;
                document.getElementById('orderId').textContent = order.id;
            }

            // Show toast notification
            showToast(message, isError = false) {
                const toast = document.getElementById('toast');
                toast.textContent = message;
                toast.className = `toast ${isError ? 'error' : ''}`;
                toast.classList.add('show');
                
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            }

            // Show cart modal
            showCartModal() {
                document.getElementById('cartModal').classList.add('active');
                document.getElementById('cartView').style.display = 'block';
                document.getElementById('checkoutForm').style.display = 'none';
                document.getElementById('receipt').style.display = 'none';
                this.renderCart();
            }

            // Show checkout form
            showCheckoutForm() {
                document.getElementById('cartView').style.display = 'none';
                document.getElementById('checkoutForm').style.display = 'block';
                document.getElementById('receipt').style.display = 'none';
            }

            // Show receipt
            showReceipt(order) {
                document.getElementById('cartView').style.display = 'none';
                document.getElementById('checkoutForm').style.display = 'none';
                document.getElementById('receipt').style.display = 'block';
                this.renderReceipt(order);
            }

            // Bind event listeners
            bindEvents() {
                // Search input
                document.getElementById('searchInput').addEventListener('input', (e) => {
                    this.searchTerm = e.target.value;
                    this.currentPage = 1;
                    this.applyFilters();
                    this.renderProducts();
                    this.renderPagination();
                });

                // Category filter
                document.getElementById('categoryFilter').addEventListener('change', (e) => {
                    this.selectedCategory = e.target.value;
                    this.currentPage = 1;
                    this.applyFilters();
                    this.renderProducts();
                    this.renderPagination();
                });

                // Sort filter
                document.getElementById('sortFilter').addEventListener('change', (e) => {
                    this.sortOrder = e.target.value;
                    this.applyFilters();
                    this.renderProducts();
                });

                // Cart preview click
                document.getElementById('cartPreview').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.showCartModal();
                });

                // Close cart modal
                document.getElementById('closeCartModal').addEventListener('click', () => {
                    document.getElementById('cartModal').classList.remove('active');
                });

                // Close modal when clicking outside
                document.getElementById('cartModal').addEventListener('click', (e) => {
                    if (e.target === document.getElementById('cartModal')) {
                        document.getElementById('cartModal').classList.remove('active');
                    }
                });

                // Checkout button
                document.getElementById('checkoutBtn').addEventListener('click', () => {
                    if (this.cart.length === 0) {
                        this.showToast('Your cart is empty!', true);
                        return;
                    }
                    this.showCheckoutForm();
                });

                // Continue shopping button
                document.getElementById('continueShopping').addEventListener('click', () => {
                    document.getElementById('cartModal').classList.remove('active');
                });

                // Add to cart buttons (using event delegation)
                document.getElementById('productGrid').addEventListener('click', (e) => {
                    if (e.target.classList.contains('add-to-cart')) {
                        const productId = parseInt(e.target.dataset.id);
                        this.addToCart(productId);
                    }
                });

                // Cart quantity controls (using event delegation)
                document.getElementById('cartItems').addEventListener('click', (e) => {
                    if (e.target.classList.contains('decrease-qty')) {
                        const productId = parseInt(e.target.dataset.id);
                        this.updateCartItemQuantity(productId, -1);
                    } else if (e.target.classList.contains('increase-qty')) {
                        const productId = parseInt(e.target.dataset.id);
                        this.updateCartItemQuantity(productId, 1);
                    } else if (e.target.classList.contains('remove-item')) {
                        const productId = parseInt(e.target.dataset.id);
                        this.removeFromCart(productId);
                    }
                });

                // Cart quantity input change
                document.getElementById('cartItems').addEventListener('change', (e) => {
                    if (e.target.classList.contains('quantity-input')) {
                        const productId = parseInt(e.target.dataset.id);
                        const newQuantity = parseInt(e.target.value);
                        
                        // Validate input
                        if (isNaN(newQuantity) || newQuantity < 1) {
                            e.target.value = 1;
                            return;
                        }
                        
                        const product = this.dataManager.getProductById(productId);
                        if (newQuantity > product.stock + this.getCartItemQuantity(productId)) {
                            e.target.value = product.stock + this.getCartItemQuantity(productId);
                            this.showToast('Not enough stock available!', true);
                            return;
                        }
                        
                        this.setCartItemQuantity(productId, newQuantity);
                    }
                });

                // Order form submission
                document.getElementById('orderForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.processOrder();
                });

                // Keyboard navigation support
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        document.getElementById('cartModal').classList.remove('active');
                    }
                });
            }

            // Get quantity of a specific item in cart
            getCartItemQuantity(productId) {
                const item = this.cart.find(item => item.productId === productId);
                return item ? item.quantity : 0;
            }

            // Add product to cart
            addToCart(productId) {
                const product = this.dataManager.getProductById(productId);
                
                if (!product) {
                    this.showToast('Product not found!', true);
                    return;
                }
                
                if (product.stock <= 0) {
                    this.showToast('This product is out of stock!', true);
                    return;
                }

                const existingItemIndex = this.cart.findIndex(item => item.productId === productId);
                
                if (existingItemIndex !== -1) {
                    // Update existing item
                    if (this.cart[existingItemIndex].quantity >= product.stock) {
                        this.showToast('No more stock available for this product!', true);
                        return;
                    }
                    
                    this.cart[existingItemIndex].quantity += 1;
                } else {
                    // Add new item
                    this.cart.push({
                        productId: productId,
                        quantity: 1
                    });
                }
                
                // Update cart in storage and UI
                this.dataManager.saveCart(this.cart);
                this.updateCartPreview();
                this.showToast(`${product.name} added to cart!`);
                
                // Update product stock
                this.dataManager.updateProductStock(productId, product.stock - 1);
                
                // Refresh product display
                this.loadProducts();
            }

            // Update cart item quantity
            updateCartItemQuantity(productId, change) {
                const itemIndex = this.cart.findIndex(item => item.productId === productId);
                
                if (itemIndex === -1) return;
                
                const product = this.dataManager.getProductById(productId);
                const currentQuantity = this.cart[itemIndex].quantity;
                const newQuantity = currentQuantity + change;
                
                if (newQuantity < 1) {
                    this.removeFromCart(productId);
                    return;
                }
                
                if (newQuantity > product.stock + currentQuantity) {
                    this.showToast('Not enough stock available!', true);
                    return;
                }
                
                // Update stock
                const stockChange = currentQuantity - newQuantity; // Negative if increasing
                this.dataManager.updateProductStock(productId, product.stock - stockChange);
                
                // Update cart
                this.cart[itemIndex].quantity = newQuantity;
                this.dataManager.saveCart(this.cart);
                this.renderCart();
                this.updateCartPreview();
                
                if (change > 0) {
                    this.showToast('Quantity increased!');
                } else {
                    this.showToast('Quantity decreased!');
                }
            }

            // Set cart item quantity directly
            setCartItemQuantity(productId, newQuantity) {
                const itemIndex = this.cart.findIndex(item => item.productId === productId);
                
                if (itemIndex === -1) return;
                
                const product = this.dataManager.getProductById(productId);
                const currentQuantity = this.cart[itemIndex].quantity;
                
                if (newQuantity > product.stock + currentQuantity) {
                    this.showToast('Not enough stock available!', true);
                    return;
                }
                
                // Update stock
                const stockChange = currentQuantity - newQuantity;
                this.dataManager.updateProductStock(productId, product.stock - stockChange);
                
                // Update cart
                this.cart[itemIndex].quantity = newQuantity;
                
                // Remove if quantity is 0
                if (newQuantity <= 0) {
                    this.cart.splice(itemIndex, 1);
                }
                
                this.dataManager.saveCart(this.cart);
                this.renderCart();
                this.updateCartPreview();
                this.showToast('Quantity updated!');
            }

            // Remove item from cart
            removeFromCart(productId) {
                const itemIndex = this.cart.findIndex(item => item.productId === productId);
                
                if (itemIndex === -1) return;
                
                const product = this.dataManager.getProductById(productId);
                const quantityToRemove = this.cart[itemIndex].quantity;
                
                // Restore stock
                this.dataManager.updateProductStock(productId, product.stock + quantityToRemove);
                
                // Remove from cart
                this.cart.splice(itemIndex, 1);
                this.dataManager.saveCart(this.cart);
                this.renderCart();
                this.updateCartPreview();
                this.showToast('Item removed from cart!');
            }

            // Process order
            processOrder() {
                // Get form values
                const customerName = document.getElementById('customerName').value.trim();
                const customerEmail = document.getElementById('customerEmail').value.trim();
                const shippingAddress = document.getElementById('shippingAddress').value.trim();
                const paymentInfo = document.getElementById('paymentInfo').value.trim();

                // Basic validation
                if (!customerName || !customerEmail || !shippingAddress || !paymentInfo) {
                    this.showToast('Please fill in all required fields!', true);
                    return;
                }

                // Validate email format
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(customerEmail)) {
                    this.showToast('Please enter a valid email address!', true);
                    return;
                }

                // Calculate order totals
                const subtotal = this.cart.reduce((total, item) => {
                    const product = this.dataManager.getProductById(item.productId);
                    return total + (product ? product.price * item.quantity : 0);
                }, 0);

                const tax = subtotal * 0.085;
                const total = subtotal + tax;

                // Create order object
                const order = {
                    id: 'ORD' + Date.now().toString(36).toUpperCase(),
                    timestamp: new Date().toLocaleString(),
                    customerName,
                    customerEmail,
                    shippingAddress,
                    paymentInfo: '**** **** **** ' + paymentInfo.slice(-4), // Mask payment info
                    items: this.cart.map(item => {
                        const product = this.dataManager.getProductById(item.productId);
                        return {
                            productId: item.productId,
                            name: product.name,
                            price: product.price,
                            quantity: item.quantity
                        };
                    }),
                    subtotal,
                    tax,
                    total
                };

                // Save order
                this.dataManager.saveOrder(order);

                // Clear cart
                this.cart = [];
                this.dataManager.saveCart(this.cart);
                this.updateCartPreview();

                // Show receipt
                this.showReceipt(order);

                // Show success message
                this.showToast('Order placed successfully! Thank you for your purchase.');
            }
        }

        /**
         * APPLICATION INITIALIZATION
         * Initialize the application when the DOM is loaded
         */
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize data manager
            const dataManager = new StoreDataManager();
            
            // Initialize UI
            const storeUI = new StoreUI(dataManager);
            
            // Make storeUI available globally for debugging
            window.storeUI = storeUI;
        });
    </script>
</body>
</html>
